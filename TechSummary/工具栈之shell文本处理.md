# 管道和重定向
## 管道
* 哲学：程序应该只关注一个目标，并尽可能把它做好。让程序能够互相协同工作。应该让程序处理文本数据流，因为这是一个通用的接口。 -- Douglas McIlroy
* 管道是一种通信机制，通常用于进程间的通信（也可通过socket进行网络通信），它表现出来的形式将**前面每一个进程的输出（stdout）直接作为下一个进程的输入（stdin）**
* 通过管道组合各种文本处理命令和工具，完成复杂文本处理功能！

## 重定向
* 控制终端数据流，将标准输入，标准输出，标准错误指向到别的文件（不限于普通文件）
* Linux的shell对数据流进行以下分类定义：
> stdin 标准输入 编号为：0 默认：键盘
> stdout 标准输出 编号为：1 默认：终端
> stderr 标准错误 编号为：2 默认：终端
* 符号和语义
> \> 将标准输入以覆盖形式重定向到指定文件
> \>> 将标准输入以追加形式重定向到指定文件
> \< 重定向标准输入
> 2> 重定向标准错误
> 2>&! 将标准错误合并到标准输出中

# 文本查看
1. cat ：由第一行开始显示档案内容
2. tac ：从最后一行开始显示，可以看出tac是cat的倒着写
3. more ：一页一页地显示文档内容
4. less ：和more类似，但是比more更好的是，他可以往前翻页。
5. head：只看头几行，后面可以带“-n 数字”,表示看头多少行。
6. tail：只看尾几行
7. sort : 对文本进行排序
8. uniq：对文本进行查重 -c -d -u
9. wc：计数功能 计算行数，字节数，词数

# grep 
* 能够在一个或多个文件中，搜索某一特定地字符模式(也就是正则表达式)，此模式可以是单一地字符，字符串，单词或句子。
* 格式： grep [选项] ‘{pattern}’
常用选项和参数

选项 | 含义  
-|-
-E | 支持拓展正则表达式，等价于 egrep
-a | 将binary文件以text文件的方式搜寻数据
-c | 计算找到‘搜寻字符串’的次数
-i | 忽略大小写的不同
-n | 在每一行的最前面列出行号
-v | 列出没有匹配模式的行
--color=auto | 匹配部分高亮

# sed
* stream edit，流编辑器
* 每次仅读取一行内容
* 根据提供的规则命令匹配并修改数据。注意，sed默认不会直接修改源文件数据，而是会将数据复制到缓冲区中，修改也仅限于缓冲区中的数据；将执行结果输出；
* 当一行数据处理完成后，它会继续读取下一行数据，并重复这个过程，直到将文件中所有数据处理完毕。
* 三要素，**选项，范围，操作**

# awk
* 一种处理文本的编程语言工具，读取输入文件，为数据排序，处理数据，对输入执行计算以及生成报表，还有无数其他的功能。
* 主要思想是按行扫描文本文件或文本流中的数据，对当前行文本进行模式匹配，匹配成功则继续执行数据处理模块的内容，反之则继续处理下一行数据
* 命令语法可以简单地记为：awk 'pattern {action}'
* [awk quick ref]([http://www.cheat-sheets.org/saved-copy/awk_quickref.pdf](http://www.cheat-sheets.org/saved-copy/awk_quickref.pdf))

# 作业
编写一个脚本，从日志文件统计登陆角色数和登录渠道数，并定时运行：
1. 脚本接受两个参数：输入文件路径和要统计的日期（格式yyyyMMdd）
2. 定时每天凌晨1～3点每小时运行一次，统计当天的指标
3. 角色数和渠道数需要去重

输入格式：
/home/g60/gamedata/log/g60_GameStatistic_20190716.log [2019-07-16 00:00:06][LoginRole],{"last_logout_time":0,"ip":"117.136.90.171","vip":0,"app_channel":"oppo","role_id":"97054387","same_udid":"97054387"}

输出格式：
日期（yyyyMMdd） 角色数量(去重后的数量) 渠道数量(去重后的数量)

注意：
* 角色字段为 role_id，渠道字段为app_channel
* 角色字段值皆为数字，渠道字段值可能为大小写字母和数字混合，需统一转为小写
* 过滤掉字段last_logout_time为0的记录
[文件地址]

